@model ExpressQuiz.ViewModels.ActiveQuizViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Scripts/jquery.bootpag.min.js"></script>
<script src="~/Scripts/expressquiz/main.js"></script>
<br />
<div class="btn-group btn-group-justified">


    <a id="done" class="btn btn-default" href="#">Done</a>
</div>


<div>
    
    <div class="progress">
        <div class="progress-bar" style="width: 0%;"></div>
    </div>
    <div id="page-selection"></div>
    <div id="content">

        <h4>Question</h4>
        <p style="white-space: pre" id="qDesc"> </p>

        <h4>Answers</h4>
        <p>
            <div id="answers" class="col-lg-10">
            </div>
        </p>

    </div>

    <br />

    <script>
    $(document).ready(function () {

        $.ajax({
            url: "/ActiveQuiz/GetQuiz/" + "@Model.Quiz.ID",
            type: "GET",

        })
        .done(function (results) {
            load(results);
        });

    });

    $("#done").click(function () {
        var result = {};
        result.QuizId = "@Model.Quiz.ID";
        result.Answers = runtime.getResult();
        debugger;

        $.ajax({
            url: '/ActiveQuiz/PostResult/',
            async: false,
            type: "POST",
            data: JSON.stringify(result),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            error: function (jqXHR, textStatus, errorThrown) {
                alert(jqXHR + "-" + textStatus + "-" + errorThrown);
            },
            success: function(data, textStatus, jqXHR) {
                var url = '/QuizReview/Index/' + data;
                window.location.href = url;
            }

        });

        @*$.post("/ActiveQuiz/PostResult/", JSON.stringify(result), function (data) {
            var url = '@Url.Action("Summary", "ActiveQuiz")' + "/" + data;
            window.location.href = url;
        });*@
    });


    function loadQuestion(question, answer) {

  
        $("#qDesc").text(question.Text);
        $("#answers").empty();

        for (var i = 0; i < question.Answers.length; i++) {
            var checked = answer == i ? "checked" : "";

            var div = $(" <div class='radio'/>");
            var label = $("<label/>");
            var input = $("<input type='radio' " + checked + " name='optionsRadios' id=" + i + " value=" + i + ">");


            label.append(input);
            label.append(question.Answers[i].Text);
            div.append(label);
            $("#answers").append(div);
        }

        $('input[type=radio][name=optionsRadios]').on('change', function() {
            var a = $('input[name=optionsRadios]:checked', '#answers').val();
            runtime.setAnswer(runtime.currentQuestionIndex, a);
            updateProgress();
        });
    }

    var runtime = undefined;

    function load(quiz) {

        runtime = new ExpressQuiz.Runtime(quiz);

        $('#page-selection').bootpag({
            total: runtime.quiz.Questions.length,
            page: 1,
            maxVisible: 5,
            next: "next",
            prev: "previous",
        }).on("page", function(event, num) {
            //var a = $('input[name=optionsRadios]:checked', '#answers').val();
            //runtime.setAnswer(runtime.currentQuestionIndex, a);

            runtime.setActiveQuestion(num - 1);
            var question = runtime.getActiveQuestion(num - 1);
            loadQuestion(question, runtime.getAnswer(runtime.currentQuestionIndex));

        });

        loadQuestion(quiz.Questions[0]);

    }


    function updateProgress() {
        var value = runtime.getProgress();
        $('.progress-bar').css('width', value + '%').attr('aria-valuenow', value);
    }


    </script>


</div>






<div class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
                <p>One fine body…</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>